```
PHEP: 9999
Title: PyHC standardization for Python time objects
Author: Nabil Freij <nabil.freij@gmail.com> <https://orcid.org/0000-0002-6253-082X>
Discussions-To: https://github.com/heliophysicsPy/standards/pull/X
Revision: 1
Status: Draft
Type: Standards Track
Content-Type: text/markdown; charset=UTF-8; variant=CommonMark
Created: 08-July-2024
Post-History: 08-July-2024
```

# Abstract

This PHEP recommends that all projects across the PyHC ecosystem use the standard library [datetime](https://docs.python.org/3/library/datetime.html) module or if the project has more complex requirements, they should use `astropy.time.Time` instead of creating their own time objects.

Eventually, we want to encourage that all PyHC libraries allow `astropy.time.Time` as valid time inputs to their libraries.
This has some roadblocks currently which will not allow this to happen in the near future, but hopefully with the PyHC community behind this PHEP, we can push for better astropy integration with the broader Scientific Python ecosystem.

Any existing projects that have their own time object are strongly encouraged to replace their custom time objects with `astropy.time.Time`.

# Motivation

One of the strategic goals of the PyHC Project is to "Coordinate development across projects to minimize duplication of effort".

However, all of the core (and non-core) PyHC packages were created not only before the existence of PyHC, but also before many core libraries existed within the wider Scientific Python ecosystem (from `numpy` to `scipy` to `astropy` to `spiceypy` etc).
This meant that a some PyHC packages have had to create their own implementations of specific components like time or coordinates due to necessity.

Now that the upstream ecosystem has grown at a rapid pace, the need for PyHC package specific implementations has reduced considerably.
There are at least three areas ("time", "coordinates" and "units") that require standardization, however the focus for this PHEP is to start at "time", as that is considered the *simplest* case for standardization.

To try and address the need to reduce duplication and improve interoperability between PyHC packages, decisions have to be made about reducing the number of ways the community handles the same type of operation but it has to be considered within the wider Scientific Python ecosystem.

For example, the reason that Astropy's time framework was created was to add support for astronomical formats (e.g., Julian Date (JD), Modified JD (MJD) and precise timing (e.g., a nanosecond over a Hubble Time).
None of which is possible when using the [datetime](https://docs.python.org/3/library/datetime.html) module.

# Rationale

One of the main focuses within PyHC should be around the goal of reducing the amount of code that each package has to either create and maintain that implements the same functionality.
As the mixture of people that create or maintain a PyHC core libraries leans heavily to scientists, time is a very limited quantity and spending that on maintaining different but very similar systems reduces the ability for authors of PyHC packages to spend that time on new features.

This makes the usage of `astropy` ideal as not only are they backed by a larger community than PyHC, they have a core team that maintains and extends the library, and are funded by several NASA missions.
This reduces the burden on the PyHC members to maintain larger codebases.
Furthermore, `astropy` provides many key components that would allow further standardization in future.

From a user point of view, reducing the different Application Programming Interfaces (APIs) that have to be learnt within the PyHC ecosystem reduces time spent doing the science that they are interested in.
It also adds roadblocks to interoperability if the user needs to change from one sub-domain to another.
The focus within PyHC should be to improve the user experience and reduce the walls that block the ever going need to do multi-instrument science.

There is a community worry around funding, however in this authors opinion, the current landscape provides funding opportunity given a targeted proposal.
For example, "F.7 - Support for Open-Source Tools, Frameworks, and Libraries" or "F.8 - Supplemental Open-Source Software Awards" or "B.20 - Heliophysics Tools and Methods" within their stated scope would allow proposals that can fund this refactor work.

There has also been worry that reducing the number of implementations would reduce the innovation within the PyHC community.
The author disagrees as the innovation that is driving the heliophysics field is not in adding more APIs on how to create time objects.
The scientists creating new innovative methods or finding major discoveries do not want to have to deal with switching APIs to handle very similar time objects.
All that does is slow them down.

One of the most controversial events within the Linux ecosystem (in the authors short lifetime) was the adoption of [systemd](https://systemd.io/).
Many of the arguments around that time where similar, it reduces innovation, its too complex, users have to learn a new system.
However, the maintainers of each major linux distribution embraced systemd as it provided a solid foundation to reduce their own maintenance burden but also having one system meant that one could find detailed documentation or common problems and how to solve them via an internet search.

The adoption of `astropy` is in the authors opinion, the same.
It provides a new foundation that not only reduces the amount of code within PyHC that handles the same functionality, it allows users to focus on the parts of their work that matter.
Not only would adding more features to `astropy` benefit the astronomy community, it would in turn benefit the PyHC ecosystem.

The main issue with using `astropy.time` is the lack of support for this index within pandas, xarray and polars.
The hope is that with this PHEP, we can demonstrate that there is enough desire from this community that we can push for better astropy integration with the broader ScientiÔ¨Åc Python community.

# Specification

- If a package is using `datetime`, nothing changes.
- For libraries that provide a custom time object, the deprecated of such an object and support for  `astropy.time.Time` would on the surface be simplest.
  Another choice is to rebase the existing time object onto `astropy.time.Time` to avoid breaking existing user code directly.

It is important to note that for new time formats, they do not need to added to `astropy`, they can be in the same PyHC package as they are currently.
The time framework has been designed to be extendable without adding code changes to `astropy`.

# Backwards Compatibility

This policy introduces backwards incompatibilities for libraries that have their own custom time object.

To reduce backwards incompatibilities, theses projects might add support for `astropy.time` by making it a valid input for their libraries and emitting a deprecation warning when the old time object is used.
Within the deprecation message, it would inform users when they would expect their old code to break and provide information on how to transition.
In other places, it might be possible to take an existing class and underneath make it use `astropy.time` therefore not breaking existing user code for that package.

# Security Implications

For projects using `datetime`, nothing will change.
For projects that have custom time objects, they would have a `astropy` as a core dependency but as  `astropy` already sees widespread use on NASA/NSO and other operational environments, there should be no new security implications.
However there might be more of a concern for more tightly controlled operational environments which would need to be investigated.

# How to Teach This

- Video meetings to help developers of core packages learn `astropy.time` from either people familiar with `astropy.time` or the astropy developers themselves.
- [`astropy.time` documentation is pretty extensive.](https://docs.astropy.org/en/stable/time/)
- Creation of migration guides to help users update their existing code for each library.

# Reference Implementation

Switching to using `astropy.time` instead of custom time objects won't involve having one reference implementation.
However, both `sunpy` and `plasmapy` use `astropy.time.Time` internally and `sunpy` contains examples of extending `astropy.time.Time` to support extra time formats but also datetime string parsing.

- [New time epoch](https://github.com/sunpy/sunpy/blob/main/sunpy/time/timeformats.py)
- [New datetime string formats](https://github.com/sunpy/sunpy/blob/main/sunpy/time/time.py#L37)

# Rejected Ideas

None so far.

# Open Issues

- Is there a community desire to push astropy to integrate more broadly with pandas, xarray and polars?

# Footnotes

None so far.

# Revisions

Revision 1 (pending): Initial draft.

# Copyright

This document is placed in the public domain or under the CC0-1.0-Universal license, whichever is more permissive.
It should be cited as:

```bibtex
@techreport(phep9999,
  author = {Nabil Freij},
  title  = {PyHC time standardization},
  year = {2024},
  type = {PHEP},
  number = {9999},
  doi = {10.5281/zenodo.xxxxxxx}
)
```
